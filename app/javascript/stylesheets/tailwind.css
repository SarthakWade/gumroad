@layer theme, base, components, utilities;
@import "tailwindcss/theme.css" layer(theme);
@import "tailwindcss/utilities.css" source(none);
/* Should be layer(utilities) but that conflicts with the legacy non-layer CSS */
@plugin "@tailwindcss/typography";
/*
 * By default Tailwind checks all files in the project for classes, but in Gumroad that causes performance issues.
 * Whitelisting source directories solves the issue, but we need to keep the list up to date to cover all frontend code.
 */
@source "../**/*.{ts,tsx}";
@source "../../views/**/*.erb";
@source "../../../public/help/**/*.html";

/*
 * Tailwind's default hover variant is only applied in user agents that actually support mouse hovering.
 * This makes sense as hover-only UX is an issue on phones and especially screenreaders.
 * However, this breaks hover in *headless* Capybara (CI), so we're overriding this for now.
 * Once all hover UX supports alternative methods like keyboard focus and these tests have been adjusted,
 * we should remove this override.
 */
@custom-variant hover (&:hover);

@theme {
  --color-black: #000000;
  --color-white: #ffffff;
  --color-pink: #ff90e8;
  --color-purple: #90a8ed;
  --color-green: #23a094;
  --color-orange: #ffc900;
  --color-red: #dc341e;
  --color-yellow: #f1f333;
  --color-violet: #b23386;
  --color-gray: #f4f4f0;
  --color-dark-gray: #242423;

  --color-body: var(--body-bg);
  --color-background: rgb(var(--filled));
  --color-foreground: rgb(var(--color));
  --color-border: rgb(var(--color) / var(--border-alpha));
  --color-backdrop: rgb(0 0 0 / 0.8);
  --color-accent: rgb(var(--accent));
  --color-accent-foreground: rgb(var(--contrast-accent));
  --color-primary: rgb(var(--primary));
  --color-primary-foreground: rgb(var(--contrast-primary));
  --color-active-bg: rgb(var(--color) / var(--gray-1));
  --color-muted: rgb(var(--color) / var(--gray-3));
  --color-success: rgb(var(--success));
  --color-success-foreground: rgb(var(--contrast-success));
  --color-danger: rgb(var(--danger));
  --color-danger-foreground: rgb(var(--contrast-danger));
  --color-primary: rgb(var(--primary));
  --color-primary-foreground: rgb(var(--contrast-primary));
  --color-warning: rgb(var(--warning));
  --color-warning-foreground: rgb(var(--contrast-warning));
  --color-info: rgb(var(--info));

  --shadow: 0.25rem 0.25rem 0 currentColor;
  --shadow-lg: 0.5rem 0.5rem 0 currentColor;

  --spacing-product-page: 75.25rem;
  --grid-cols-sidebar: 1fr 3fr;

  --loading-spinner: url("~images/loading-rainbow.svg");
  --product-cover-placeholder: url("~images/placeholders/product-cover.png");
}

@layer base {
  .scoped-tailwind-preflight {
    @import "tailwindcss/preflight.css";

    &,
    * {
      border-color: var(--color-border);
    }
  }
}

/* Coins parallax animation */
.parallax-up {
  transform: translateY(0);
  will-change: transform;
  transition: transform 0.1s linear;
  transform-style: preserve-3d;
  animation: parallax-scroll linear;
  animation-timeline: view();
  animation-range: entry exit;
  animation-fill-mode: forwards;
}

@keyframes parallax-scroll {
  to {
    transform: translateY(-50%);
  }
}

@keyframes marquee {
  0% {
    transform: translateX(0);
  }

  50% {
    transform: translateX(-50%);
  }

  100% {
    transform: translateX(0);
  }
}

@keyframes marquee-scroll {
  0% {
    transform: translateX(0);
  }

  100% {
    transform: translateX(-50%);
  }
}

/* JWPlayer - third-party library injects these elements */
.jwplayer {
  position: absolute;
  width: 100%;
  height: 100%;
}

.jwplayer .jw-time-tip {
  min-width: max-content;
}

/* Chromium draggable bug workaround - vendor prefix */
button[draggable="true"] {
  -webkit-user-drag: element;
}

/* Firefox selection fix - pseudo-element */
.rich-text .selected *::selection {
  background: none;
}

/* Overlay page for embeds */
body#overlay-page {
  display: flex;
  flex-direction: column;
  background: transparent;
}

body#overlay-page:not(.gumroad-minimized) {
  background: rgb(0 0 0 / 0.5);
}

body#overlay-page .product-display {
  overflow: auto;
}

/* Rich text embed preview */
.rich-text .embed > .preview {
  padding: calc(56.25% + 1rem) 0 0 0;
}

.rich-text .embed > .preview > :first-child.placeholder {
  position: absolute;
  width: calc(100% - 2rem);
}

/* Form section styling */
form > main section {
  display: grid;
  padding: 3rem 0;
  border-top: solid 0.0625rem rgb(var(--color) / var(--border-alpha));
  gap: 2rem;
}

form > main section > header {
  display: grid;
  gap: 0.75rem;
  align-content: start;
}

form > main section:not(form + form section):first-of-type {
  padding-top: 0;
  border-top: none;
}

/* Product card - Firefox/Safari fixes */
article.product-card .thumbnails > * {
  width: 100%;
}

@media (min-width: 1024px) {
  article.product-card.horizontal {
    display: flex;
  }

  article.product-card.horizontal > figure {
    height: 100%;
  }

  article.product-card.horizontal > figure img {
    width: unset;
    min-width: 100%;
  }

  article.product-card.horizontal .thumbnails {
    flex: 1;
  }

  article.product-card.horizontal section {
    flex: 2;
  }
}
